# win-iso2usb

Утилита для записи ISO образов Windows10/11 на USB-флеш накопили для MacOS

# Почему это нужно

Может быть кто-то знает другие решения, но у меня создание загрузочной флешки с инсталлятором Windows из MacOS 
всегда было связано с уймой трудностей и занимало не мало времени. Этот документ создан, чтобы задокументировать 
трудности с которыми я сталкивался, а так-же неверные решения, которые мне предлагали в интернете, чтобы 
больше не тратить на них время. Апогеем моих изысканий стал скрипт `win-iso2usb.py`, автоматизирующий действия 
из вот этой [инструкции](https://www.sysgeeker.com/how-to-create-windows-11-bootable-usb-on-mac.html#method_1). 
Изложенные в статье команды решели мою задачу по запись флешки. Более удачного способа записи флешки с 
установщиком Windows из MacOS я просто не знаю.

## Что предлагали в интернете

- **❌Balena Etcher**. Красивая OpenSource утилита, которая позволяет легко записывать iso-файлы. Вот только мне 
ни разу не удалось загрузиться с флешек, подготовленных этой программой. В случае, если попытаться выбрать 
iso-файл с установщиком Windows, Etcher вежливо скажет, что он возможно не справится с задачей и отправит к 
стандарной утилите MacOS - **Boot Camp**
<img width="912" alt="Screenshot 2023-03-12 at 14 01 06" src="https://user-images.githubusercontent.com/69031401/224532055-30b5d8f0-b425-420c-9bf0-0cca566baeb3.png">

- **❌Boot Camp**. Стандартная утилита MacOS для установки Windows на компьютеры Mac. Невозможно установить на MacOS 
с процессорами M1, т.к. на такие компьютеры нельзя установить Windows

- **❌WonderISO**. После того как укажешь все настройки и будешь предвкушать успех операции, программа сообщает, 
что нужен лицензионный ключ. Кнопка Trial не работает
<img width="906" alt="Screenshot 2023-03-12 at 14 04 56" src="https://user-images.githubusercontent.com/69031401/224532235-e56e9c82-fc2a-4b32-8db7-10b4f54a12bd.png">

- **❌Deepin Boot Maker**. Подозрительная утилита, которую предлагают скачать с ресурсов не вызывающих доверия. Не 
рискнул запускать на Mac

- **❌Ручное копирование файлов**. Самый близкий к правде способ, но не рабочий. Заключается в:
  - форматировании флешки MBR/MS-FAT
  - монтировании iso файла с инсталлятором Windows
  - копирование всех файлов с примонтированного раздела iso на флешку

Возможно такой способ работал для Windows10 и более ранних версий, но не подходит для Windows11. Потому как файл 
`sources/install.wim` весит более 4Гб

- **✅Терминал**. Посредством команд терминала аналогично предыдущему способу 
  - форматируется флешка MBR/MS-FAT
  - монтируется iso файл
  - копируются все файлы с примонтированного раздела iso на флешку, кроме `sources/install.wim`
  - файл `sources/install.wim` разбивается на несколько частей с помощью утилиты `wimlib-imagex`. Для ее работы 
потребуются Homebrew и утилиты командной строки xcode

